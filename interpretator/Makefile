# Файлы зависимостей - это текстовые файлы, которые создаются компилятором в 
#	процессе компиляции исходных файлов. Эти файлы содержат информацию о зависимостях 
#	между исходными файлами и включенными заголовочными файлами. Каждая строка 
#	файла зависимостей представляет собой путь к объектному файлу (обычно .o) и 
#	список файлов, от которых этот объектный файл зависит.

# Файлы зависимостей обычно создаются с помощью флага -MMD или -MD компилятора GCC. 
#	Флаг -MMD приводит к созданию файлов зависимостей в формате Makefile, в то время 
#	как -MD также включает в файл зависимостей цели компиляции.

# Подключение файлов зависимостей в Makefile обычно выполняется с помощью команды include. 
#	В Makefile указывается, что файлы зависимостей должны быть включены, чтобы обеспечить 
#	правильную компиляцию в случае изменения исходных файлов.

# Пример подключения файлов зависимостей в Makefile:
#	-include $(OBJS:.o=.d)
#	Эта команда включает файлы зависимостей для всех объектных файлов в Makefile. 
#	После включения файлов зависимостей, если какой-либо из зависимых исходных файлов был 
#	изменен, Make перекомпилирует только те объектные файлы, которые зависят от измененных 
#	файлов, обеспечивая таким образом быструю и эффективную сборку проекта.

# Compiler
CC := gcc
# Compiler flags
CFLAGS := -Wall -Wextra -g
# Source directory
SRC_DIR := ./src
# Object directory
OBJ_DIR := ./obj
# Binary directory
BIN_DIR := ./bin
# Target executable name
TARGET := interpretator

# Find all source files in the source directory
SRCS := $(wildcard $(SRC_DIR)/*.c)
# Generate object file names from source files
OBJS := $(patsubst $(SRC_DIR)/%.c,$(OBJ_DIR)/%.o,$(SRCS))

# Include dependencies (generated by GCC -MMD -MP option)
-include $(OBJS:.o=.d)

.PHONY: all clean

# Default target - builds the binary file
all: $(BIN_DIR)/$(TARGET)

# Rule to build the target binary file
$(BIN_DIR)/$(TARGET): $(OBJS) | $(BIN_DIR)
	$(CC) $(CFLAGS) $^ -o $@

# Rule to build object files from source files
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.c | $(OBJ_DIR)
	$(CC) $(CFLAGS) -MMD -MP -c $< -o $@

#$(OBJ_DIR)/%.o: $(SRC_DIR)/%.c | $(OBJ_DIR)
#	@echo "Compiling $<"
#	$(CC) $(CFLAGS) -MMD -MP -c $< -o $@
#	@echo "Dependencies for $<:"
#	@cat $(OBJ_DIR)/$*.d

# Rule to create the object directory
$(OBJ_DIR):
	mkdir -p $@

# Rule to create the binary directory
$(BIN_DIR):
	mkdir -p $@

# Clean rule - removes object and binary directories
clean:
	rm -rf $(OBJ_DIR) $(BIN_DIR)